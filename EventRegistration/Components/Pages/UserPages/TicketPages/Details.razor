@page "/tickets/details"
@using Microsoft.EntityFrameworkCore
@using EventRegistration.Domain
@inject IDbContextFactory<EventRegistration.Data.EventRegistrationContext> DbFactory
@inject NavigationManager NavigationManager

<PageTitle>Ticket Details</PageTitle>

<div class="page-container">
    <div class="page-header">
        <h1>Ticket Details</h1>
    </div>

    @if (ticket is null)
    {
        <div class="loading-container">
            <p class="loading-text">Loading...</p>
        </div>
    }
    else
    {
        <div class="ticket-details-container">
            <h2 class="section-title">Ticket Information</h2>

            <div class="details-grid">
                <div class="detail-item">
                    <span class="detail-label">Price</span>
                    <span class="detail-value">@ticket.Price</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Type</span>
                    <span class="detail-value">@ticket.Type</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Event ID</span>
                    <span class="detail-value">@ticket.EventId</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Date Created</span>
                    <span class="detail-value">@ticket.DateCreated</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Date Updated</span>
                    <span class="detail-value">@ticket.DateUpdated</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Created By</span>
                    <span class="detail-value">@ticket.CreatedBy</span>
                </div>

                <div class="detail-item">
                    <span class="detail-label">Updated By</span>
                    <span class="detail-value">@ticket.UpdatedBy</span>
                </div>
            </div>

            <div class="actions">
                <a href="@($"/tickets/edit?id={ticket.Id}")" class="btn btn-primary">Edit Ticket</a>
                <a href="@($"/events/{ticket.EventId}/tickets")" class="btn btn-secondary">Back to List</a>
            </div>
        </div>
    }
</div>

@code {
    private Ticket? ticket;

    [SupplyParameterFromQuery]
    private int Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        using var context = DbFactory.CreateDbContext();
        ticket = await context.Ticket.FirstOrDefaultAsync(m => m.Id == Id);

        if (ticket is null)
        {
            NavigationManager.NavigateTo("notfound");
        }
    }
}
